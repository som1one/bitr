# Backend Scripts

## Синхронизация данных из Bitrix24

### sync_bitrix_to_db.py

Скрипт для подтягивания всех сделок с рассрочкой из Bitrix24 и заполнения локальной БД.

**Использование:**
```bash
# Из корня проекта
python -m backend.scripts.sync_bitrix_to_db

# Или напрямую
python backend/scripts/sync_bitrix_to_db.py

# В Docker контейнере
docker compose exec backend python -m scripts.sync_bitrix_to_db
```

**Что делает:**
- Получает все сделки с типом оплаты "Рассрочка" из Bitrix24
- Для каждой сделки получает полные данные (включая UF_* поля)
- Получает email контакта
- Создает или обновляет запись в локальной БД
- Защищает локальные данные: не перезаписывает paid_amount, если локальное значение больше

**Примечание:** Скрипт не удаляет сделки из БД, которые больше не существуют в Bitrix24.

---

# Скрипты для тестирования

## Генерация тестовых данных

### Автоматический режим (по умолчанию)

Backend автоматически возвращает тестовые данные, если:
- Переменная окружения `USE_MOCK_DATA=true` (по умолчанию)
- Bitrix24 API недоступен
- Сделка не найдена в Bitrix24

### Тестовые данные по умолчанию

- **ID сделки**: TEST_DEAL_001
- **Общая сумма**: 300,000 ₽
- **Срок**: 6 месяцев
- **Оплачено**: 100,000 ₽ (2 платежа из 6)

### Отключение тестовых данных

Чтобы использовать реальный Bitrix24 API, установите в `.env`:
```
USE_MOCK_DATA=false
```

### Ручная генерация тестовых данных

Запустите скрипт для просмотра различных тестовых сценариев:

```bash
# В контейнере backend
docker-compose exec backend python scripts/generate_test_data.py

# Или локально (если установлен Python)
cd backend
python scripts/generate_test_data.py
```

Скрипт покажет примеры разных сделок с различными параметрами.

